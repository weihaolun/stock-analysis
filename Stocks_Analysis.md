# Stocks Analysis with Excel VBA

## I. Overview of Project
### Background
We have been assisting Steve to conduct analysis on stocks with Visual Basic Application on Excel. The Dataset for this project contains trading data of 12 stocks for year 2017 and 2018. Initially, Steve was interested in Daqo New Energy Corp (ticker:DQ) and requested us to analyze the performance of this specific stock. However, after seeing the analysis result for DQ, Steve would like to see a thorough analysis for all the stocks on their volumes and returns so that he can pick the right stocks to invest. 

For his request, the program “All Stocks Analysis” was written in VBA to print out a list of 12 tickers with Total Daily Volume and Return of each. An option to choose from 2017 and 2018 was also added to the program. Steve can easily see the data for 2017 or 2018 by clicking a button.

### Purpose
Program that runs well for 12 stocks may not be efficient enough for 120 stocks. Therefore, the purpose of this project is to refactor the code and improve the performance. After refactoring, the program should:
1.	Run faster for the 12 stocks.
2.	Run well for thousands of stocks.

This following part of this report includes the Stock Performance Analysis	for Steve, Refactored Script Analysis for us to review the refactoring process, and a Summary of pros and cons of refactoring VBA script.

## II. Results
### Stock Performance Analysis
The most important metric to measure the 12 stocks performance for this dataset is Return. Before looking into return, let’s also take a look at **Total Daily Volume 2017 vs. 2018.**

Please see the table below for the performance analysis of stocks in 2017 and 2018. 
![stock_analysis_table](https://user-images.githubusercontent.com/84211948/123506937-81bf2b00-d602-11eb-80a8-291e9d9c5419.png)
_(Note: the data in this table are pulled from the tables generated by the VBA code, which will be address in the next section)_

**Volume 2017 vs. 2018**
- According to the **Volume Change YOY column**, 7 out of 12 stocks have an increase in total volumes, which means these 7 stocks are traded more frequently in 2018 than in 2017.  The top two volume increased stocks are DQ and ENPH. DQ increased the most, 201.4%, then ENPH increased 173.9%. However, DQ’s Volume is still very low since DQ has the lowest volume in 2017 among all stocks.
- The top two most traded stocks in 2017 are SPWR and FSLR. SPWR and FSLR both has significant higher volumes than the other stocks. In 2018, ENPH, SQWR, RUN and FSLR these four stocks all have significant higher volumes that the rest of the stocks. Compare year over year, both SPWR and FSLR stayed frequently traded.

**Return 2017 vs. 2018**
- Stocks’ overall performance on return was good in 2017. Only TERP had a negative return, but -7.2% wasn’t a huge down. Even though DQ didn’t have a large number of trading volume, a return of 199.4% was outstanding. In addition, SEDG (+184.5%), ENPH(+129.5%) and FSLR(+101.3%) all have over 100% returns.
- On the other hand, stocks returns of 2018 were mostly negative, only ENPH(+81.9%) and RUN(+84.0%) had positive returns. The most returned stock I of 2017, DQ, became the most lose out stock of 2018 with a -62.6% return. DQ’s high return in 2017 could be the reason why the trading volume increased 201.4% in 2018. However, the return wasn’t ideal for the second year.
- Overall, both ENPH and RUN remained positive return through both years. ENPH’s return decreased 36.8%, but it stably performing well from 129.5% to 81.9% even when the entire stock set going down on return. RUN was very close to breakeven in 2017 with a 5.5% return but reached 84.0% of return and became the most profited one among the 12 stocks. In addition, they were also both traded often in 2018, which is generally considered as a good sign for a stock market. 
- In conclusion, if Steve would like to pick one or two stocks from this list, ENPH and RUN both looks promising. However, data of only two years might be not sufficient enough to make a decision, there are also many macro factors from the market and economy environment could affect stocks performance. 

*_Pleasea see Appendix section at the end of this report for a visualized [Stock Analysis Dashboard](#appendix)_

### Refactored Script Analysis
As mentioned in above section, in some circumstances, 12 stocks or two years might not be enough to conduct a deep analysis on stocks performance, therefore, we need to ensure the program works for this analysis would also run perfectly for large dataset in the future.

The refactored code has been re-mapped for this project, in order to measure and compare the original and refactored script, I added another program running button “**Refactored Analysis for All**” on the sheet to run the code and receive the running time. Please see the screen shot below for example. 

![result_page](https://user-images.githubusercontent.com/84211948/123507106-6a347200-d603-11eb-813d-c72d2ee51180.png)

As a result, the running time of refactored code went down 80%. Please refer to the comparison below.

![graph for report](https://user-images.githubusercontent.com/84211948/123507121-7f110580-d603-11eb-89f0-8cc987349178.png)

Overall, it is because the refactored code only loops over all the rows once.
- We created three storage points to storage the data we need for the final calculation, which are the three arrays: tickerVolumes(12), tickerStartingPrices(12) and tickerEndingPrices(12).
- When looping over all the rows, the following codes are processed:
```
For i = 2 To Rowcount
    tickerVolumes(tickerIndex) = tickerVolumes(tickerIndex) + Cells(i, 8).Value
    If Cells(i - 1, 1).Value <> tickers(tickerIndex) Then
            tickerStartingPrices(tickerIndex) = Cells(i, 6).Value
    End If
    If Cells(i + 1, 1).Value <> tickers(tickerIndex) Then
            tickerEndingPrices(tickerIndex) = Cells(i, 6).Value
            tickerIndex = tickerIndex + 1
    End If
```
This is when the data got stored while looping.
- When we do final calculations for volumes and returns, all data are just pulled from the arrays above instead of going back to the loop to find the variables.
- On the other hand, for the original code, we did not create arrays. Instead, we used variables totalVolume, endingPrice and startingPrice through out the code:
```
For j = 2 To endRow
      If Cells(j, 1).Value = ticker Then
           totalVolume = totalVolume + Cells(j, 8).Value
      End If
      If Cells(j - 1, 1).Value <> ticker And Cells(j, 1).Value = ticker Then
           startingPrice = Cells(j, 6).Value
      End If
      If Cells(j + 1, 1).Value <> ticker And Cells(j, 1).Value = ticker Then
           endingPrice = Cells(j, 6).Value
      End If
 ```
 - Therefore, the data for final calculation cannot be pulled from any memory point, the program need to go back to the loop and retrieve the data from variables.

## III. Summary
### Pros and Cons of Refactoring Code
**Pros**
- Since the purpose of refactoring code is to improve it, so the first advantage of doing so is to better the performance of the script and program. The refactored script would be very likely to execute faster.
- If refactored code executes faster for a regular dataset, then the code can run on a much larger dataset with not much delay. Refactored code increases the running capability for larger sized files.
- Refactoring is also a process of reviewing the code. During this process, it’s a good chance to clean up the code and fix potential bugs.
- Once the code is cleaned up and improved, it will have a more organized structure and will be easier to maintain. This could be reused as a standardized format for future similar projects. 
- An organized scrip is also more convenient for groups work. When several teammates working on same code, it’s better to have a more cleared coding structure that’s readable and understandable for everyone.

**Cons**
- Refactoring code is definitely a time-consuming process. It at least costs time to alter partial of the code or may cost even more time to refactor the entire code structure. If there’s not enough time to refactor, test and adjust, refactoring may not be a necessary option.
- Refactoring can also be risky. If there’s more than one sets of script on one workbook, or if refactored code will affect other script’s running, refactoring may cause a series of errors and bugs. 
- Refactoring code for a group project may increase communication cost. We have to ensure everyone understand the new structure. When refactoring other’s work, we’d better to confirm why was the code written in the original way and whether it’s appropriate to alter it.

### How do these pros and cons apply to refactoring the original VBA script?
**Pros**
- Refactored scrip definitely decreased execution time for this project. As mentioned in above [section](#refactored-script-analysis), the running time went down 80%. 
- Also, to comply with the purpose of this project, refactored code can work well on larger dataset with thousands of stocks.
- The refactored code is better structured. If Steve would like to conduct stocks for other years, or add more years, this can be easily done by re-using the code structure.

**Cons**
- The refactoring process did cost more time for me to re-write the code and fully understand the code. 
- My refactoring process did cause bugs. The result from refactored code was different from the original one. I probably spent more time debugging than refactoring.
In conclusion, this refactoring process was a good practice for beginners. I learned that there are always alternative ways to solve one problem, and there are always better solutions if we put more time and thinking into it. Even though it took more time, I’m more confident with the refactored script.

## Appendix
### Stock Analysis Dashboard

![Stock_Analysis_Dashboard](https://user-images.githubusercontent.com/84211948/123497426-2fade380-d5c9-11eb-81d6-d76027a6ee37.png)


